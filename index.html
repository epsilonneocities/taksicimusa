<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Puzzle</title>
<style>
body {
  background:#0d0d0d;
  color:#e0e0e0;
  font-family: monospace;
  text-align:center;
}
.container {
  max-width:600px;
  margin:80px auto;
  border:1px solid #333;
  padding:30px;
}
input, button {
  background:black;
  color:#e0e0e0;
  border:1px solid #333;
  padding:8px;
  font-family: monospace;
}
button { cursor:pointer; }
.grid {
  display:grid;
  grid-template-columns: repeat(5, 60px);
  gap:6px;
  justify-content:center;
  margin:20px 0;
}
.cell {
  width:60px;
  height:60px;
  background:#111;
  border:1px solid #333;
  cursor:pointer;
}
.cell.on { background:#e0e0e0; }
</style>
</head>
<body>

<div class="container" id="game"></div>

<script>
let level = parseInt(localStorage.getItem("level") || "0");

const textLevels = [
  { q: "01000101 (binary) → ?", a: "e" },
  { q: "ASCII: 82", a: "r" },
  { q: "01000010", a: "b" },
  { q: "Mirror of E", a: "e" },
  { q: "Alphabet position of 18", a: "r" },
  { q: "Hex: 4b", a: "k" },
  { q: "Bir kelime: E R B E R K", a: "erberk" }
];

// --- LIGHTS OUT FINAL ---
const size = 5;
let state = [];
let initial = [];

function render() {
  const game = document.getElementById("game");
  game.innerHTML = "";

  if(level < 7) {
    const l = textLevels[level];
    game.innerHTML = `
      <h2>Seviye ${level+1}</h2>
      <p>${l.q}</p>
      <input id="ans">
      <button onclick="checkText()">Gönder</button>
      <div id="msg"></div>
    `;
  }
  else if(level === 7) {
    game.innerHTML = `
      <h2>Seviye 8</h2>
      <p>Tüm ışıkları kapat.</p>
      <div class="grid" id="grid"></div>
      <button onclick="reset()">Sıfırla</button>
      <div id="msg"></div>
    `;
    generate();
    draw();
  }
  else {
    document.body.innerHTML =
      "<h1 style='margin-top:200px'>ERBERK</h1>";
  }
}

// -------- TEXT LEVELS ----------
function checkText() {
  const input = document.getElementById("ans").value.trim().toLowerCase();
  if(input === textLevels[level].a) {
    level++;
    localStorage.setItem("level", level);
    render();
  } else {
    document.getElementById("msg").innerText = "Yanlış.";
  }
}

// -------- LIGHTS OUT ----------
function idx(x,y){return y*size+x;}

function toggle(i){
  if(i<0||i>=25)return;
  state[i]=state[i]?0:1;
}

function move(i){
  const x=i%5, y=Math.floor(i/5);
  toggle(i);
  if(y>0) toggle(idx(x,y-1));
  if(y<4) toggle(idx(x,y+1));
  if(x>0) toggle(idx(x-1,y));
  if(x<4) toggle(idx(x+1,y));
}

function clickCell(i){
  move(i);
  draw();
  if(state.every(v=>v===0)){
    level++;
    localStorage.setItem("level", level);
    render();
  }
}

function draw(){
  const grid=document.getElementById("grid");
  grid.innerHTML="";
  state.forEach((v,i)=>{
    const d=document.createElement("div");
    d.className="cell"+(v?" on":"");
    d.onclick=()=>clickCell(i);
    grid.appendChild(d);
  });
}

function generate(){
  state=new Array(25).fill(0);
  for(let i=0;i<20;i++){
    move(Math.floor(Math.random()*25));
  }
  initial=[...state];
}

function reset(){
  state=[...initial];
  draw();
}

render();
</script>

</body>
</html>
  const val = document.getElementById("answer").value.trim();
  const hash = await sha256(val);
  if(hash === hashes[level]) {
    level++;
    localStorage.setItem("level", level);
    document.getElementById("msg").innerText = "Doğru.";
    document.getElementById("answer").value = "";
    update();
  } else {
    document.getElementById("msg").innerText = "Yanlış.";
  }
}

update();
</script>

</body>
</html>
